

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoSix &mdash; pylhc_submitter 2.0.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=449bdd91" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=3e466467"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Job Submitter" href="job_submitter.html" />
    <link rel="prev" title="Welcome to the pylhc submitter documentation!" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/omc_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Submitter</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">AutoSix</a></li>
<li class="toctree-l1"><a class="reference internal" href="job_submitter.html">Job Submitter</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/constants.html">Constants Definitions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#external-paths">External Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#job-submitter">Job Submitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#htcondor">HTCondor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#autosix">Autosix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/sixdesk_tools.html">Sixdesk Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#stages">Stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#create-sixdesk-workspace">Create SixDesk Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-submission-utils">SixDesk Submission Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#post-process-da">Post Process DA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#extract-data-from-database">Extract Data From DataBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-utilities">SixDesk Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-troubleshooting-tools">SixDesk Troubleshooting tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/submitter.html">Submitter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/submitter.html#htcondor-utilities">HTCondor Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/submitter.html#job-submitter-io-tools">Job Submitter IO-Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/submitter.html#mask-resolver">Mask Resolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/submitter.html#job-submitter-runners">Job Submitter Runners</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/utils.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/utils.html#io-tools">IO-Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/utils.html#logging-tools">Logging Tools</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pylhc_submitter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">AutoSix</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/pylhc/submitter" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  
  
           <div itemprop="articleBody">
             
  <section id="autosix">
<h1>AutoSix<a class="headerlink" href="#autosix" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">AutoSix</span></code> is a wrapper to automatically perform the necessary setup and steps needed for <code class="docutils literal notranslate"><span class="pre">SixDesk</span></code> use.</p>
<p>The functionality is similar to the <code class="docutils literal notranslate"><span class="pre">pylhc_submitter.job_submitter</span></code> in that the inner product of a <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code>
is used to automatically create a set of job-directories to gather the data.
To avoid conflicts, each of these job-directories is a <code class="docutils literal notranslate"><span class="pre">SixDesk</span></code> workspace,
meaning there can be only one study per directory.
Beware that the <code class="docutils literal notranslate"><span class="pre">max_materialize</span></code> limit is set for each of these workspaces
individually, not for all Jobs together (i.e. it should be &lt;=MAX_USER_JOBS / NUMBER_OF_WORKSPACES).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> contains variables for your mask as well as variables for the SixDesk environment.
See the description of <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> below.</p>
<p>In any other way, these <em>special</em> variables behave like normal variables and can also be inserted in your mask.
They are also looped over in the same manner as any other variable (if given as a list).</p>
<p>For additional information and guides, see the <a class="reference external" href="https://pylhc.github.io/packages/pylhcsubmitter/autosix/">AutoSix page</a>
on the <code class="docutils literal notranslate"><span class="pre">OMC</span></code> documentation site.</p>
<div class="warning admonition">
<p class="admonition-title">Problems with <em>search.f90</em></p>
<p>If you run into</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ImportError:<span class="w"> </span>cannot<span class="w"> </span>import<span class="w"> </span>name<span class="w"> </span><span class="s1">&#39;search&#39;</span><span class="w"> </span>from<span class="w"> </span>partially<span class="w"> </span>initialized<span class="w"> </span>module<span class="w"> </span><span class="s1">&#39;sixdeskdb&#39;</span>
</pre></div>
</div>
<p>that means that the <code class="file docutils literal notranslate"><span class="pre">SixDesk/utilities/externals/SixDeskDB/sixdeskdb/search.f90</span></code>
has not been compiled for your current python and OS version (indicated by XXX below).
There are two ways to do this:</p>
<p><strong>a)</strong> Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>numpy.f2py<span class="w"> </span>-c<span class="w"> </span>search.f90<span class="w"> </span>-f<span class="w"> </span>search
</pre></div>
</div>
<p>with your desired python version
(a shortcut <code class="docutils literal notranslate"><span class="pre">f2py</span></code> might be available if you run in an activated venv).
Copy (or symlink) the resulting <code class="file docutils literal notranslate"><span class="pre">search.cpython-XXX.so</span></code> file into the
<code class="file docutils literal notranslate"><span class="pre">sixdeskdb</span></code> folder
(if it is not already there because you ran from that folder)</p>
<p><strong>b)</strong> Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>setup.py<span class="w"> </span>build_ext
</pre></div>
</div>
<p>on the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> in <code class="file docutils literal notranslate"><span class="pre">SixDesk/utilities/externals/SixDeskDB</span></code>.
Then copy (or symlink) the resulting <code class="file docutils literal notranslate"><span class="pre">build/lib.XXX/sixdeskdb/search.cpython-XXX.so</span></code> into
the <code class="file docutils literal notranslate"><span class="pre">sixdeskdb</span></code> folder (the name needs to stay as it is).</p>
</div>
<p>Arguments:</p>
<p><em>--Required--</em></p>
<ul>
<li><p><strong>mask</strong> <em>(Path)</em>:</p>
<blockquote>
<div><p>Path to the program’s mask to use.</p>
</div></blockquote>
</li>
<li><p><strong>replace_dict</strong> <em>(DictAsString)</em>:</p>
<blockquote>
<div><p>Dict with keys of the strings to be replaced in the mask (required) as
well as the mask_sixdeskenv and mask_sysenv files in the sixdesk_tools
module. Required fields are TURNS, AMPMIN, AMPMAX, AMPSTEP, ANGLES.
Optional fields are RESUBMISSION, PLATFORM, LOGLEVEL, FIRSTSEED,
LASTSEED, RUNTYPE, NPAIRS, EMITTANCE, DIMENSIONS, WRITEBINS, ENERGY.
These keys can also be used in the mask if needed. The values of this
dict are lists of values to replace these or single entries.</p>
</div></blockquote>
</li>
<li><p><strong>working_directory</strong> <em>(Path)</em>:</p>
<blockquote>
<div><p>Directory where data should be put into.</p>
</div></blockquote>
</li>
</ul>
<p><em>--Optional--</em></p>
<ul>
<li><p><strong>apply_mad6t_hacks</strong>:</p>
<blockquote>
<div><p>Apply two hacks: Removes ‘&lt;’ in binary call and ignore the check for
‘Twiss fail’ in the submission file. This is hack needed in case this
check greps the wrong lines, e.g. in madx-comments. USE WITH CARE!!</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>da_turnstep</strong> <em>(int)</em>:</p>
<blockquote>
<div><p>Step between turns used in DA-vs-Turns plot.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">100</span></code></p>
</div></blockquote>
</li>
<li><p><strong>executable</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to executable or ‘madx’, ‘python2’, ‘python3’ to use the OMC
default paths on AFS.Defaults to the latest MADX-Binary on AFS.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">/afs/cern.ch/user/m/mad/bin/madx</span></code></p>
</div></blockquote>
</li>
<li><p><strong>jobid_mask</strong> <em>(str)</em>:</p>
<blockquote>
<div><p>Mask-String to name jobs, with placeholders from the <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code>
keys.</p>
</div></blockquote>
</li>
<li><p><strong>max_materialize</strong> <em>(int)</em>:</p>
<blockquote>
<div><p>Maximum jobs to be materialized in scheduler (per SixDesk Workspace!)..
Here: <code class="docutils literal notranslate"><span class="pre">None</span></code> leaves the settings as defined in the SixDesk
htcondor_run_six.sub template and <code class="docutils literal notranslate"><span class="pre">0</span></code> removes it from the template.
Warning: This setting modifies the template in the <code class="docutils literal notranslate"><span class="pre">sixdesk_directory</span></code>
permanently. For more details see the htcondor API.</p>
</div></blockquote>
</li>
<li><p><strong>max_stage</strong> <em>(str)</em>:</p>
<blockquote>
<div><p>Last stage to be run. All following stages are skipped.</p>
</div></blockquote>
</li>
<li><p><strong>python2</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to python to use with run_six.sh (python2 with requirements
installed). ONLY THE PATH TO THE DIRECTORY OF THE python BINARY IS
NEEDED! And it can’t be an Anaconda Distribution. If <code class="docutils literal notranslate"><span class="pre">None</span></code> the
system’s <code class="docutils literal notranslate"><span class="pre">python</span></code> is used (SixDesk internally).</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</div></blockquote>
</li>
<li><p><strong>python3</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to python to use with sixdb (python3 with requirements
installed).Defaults to the system’s <code class="docutils literal notranslate"><span class="pre">python3</span></code>.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">python3</span></code></p>
</div></blockquote>
</li>
<li><p><strong>resubmit</strong>:</p>
<blockquote>
<div><p>Resubmits to HTCondor if needed (i.e. in case it finds errors with the
previous run).</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>sixdesk_directory</strong> <em>(Path)</em>:</p>
<blockquote>
<div><p>Path to the directory of SixDesk. Defaults to the PRO-version on AFS.
If you are using your own SixDesk Environment and it does not run,
check the AutoSix doc.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">/afs/cern.ch/project/sixtrack/SixDesk_utilities/pro</span></code></p>
</div></blockquote>
</li>
<li><p><strong>ssh</strong> <em>(str)</em>:</p>
<blockquote>
<div><p>Run htcondor from this machine via ssh (needs access to the
<code class="docutils literal notranslate"><span class="pre">working_directory</span></code>)</p>
</div></blockquote>
</li>
<li><p><strong>stop_workspace_init</strong>:</p>
<blockquote>
<div><p>Stops the workspace creation before initialization, so one can make
manual changes.</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>unlock</strong>:</p>
<blockquote>
<div><p>Forces unlocking of folders (if they have been locked by Sixdesk).</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>jdilly</p>
</dd>
</dl>
</section>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">pylhc_submitter.autosix.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">opt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pylhc_submitter/autosix.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Loop to create jobs from replace dict product matrix.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">pylhc_submitter.autosix.</span></span><span class="sig-name descname"><span class="pre">run_job</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jobname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AutoSixEnvironment</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pylhc_submitter/autosix.html#run_job"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Main submitting procedure for single job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jobname</strong> (<em>str</em>) -- Name of the job/study</p></li>
<li><p><strong>env</strong> (<em>DotDict</em>) -- The ensemble of autosix settings as an <code class="docutils literal notranslate"><span class="pre">AutoSixEnvironment</span></code> object.</p></li>
<li><p><strong>jobargs</strong> (<em>dict</em>) -- All Key=Values needed to fill the mask!</p></li>
</ul>
</dd>
</dl>
</dd></dl>



           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to the pylhc submitter documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="job_submitter.html" class="btn btn-neutral float-right" title="Job Submitter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>